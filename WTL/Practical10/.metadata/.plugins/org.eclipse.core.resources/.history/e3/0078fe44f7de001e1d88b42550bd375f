package com.practical10;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import javax.ejb.EJB;
import javax.ejb.LocalBean;
import javax.ejb.Stateless;

@Stateless
@LocalBean
@EJB
public class DepositBean {

    public DepositBean() {
        // Default constructor
    }	

    public static void depositAmount(double amount) {
        Connection conn = null;
        PreparedStatement pstmt = null;
        ResultSet rs = null;
    	try {
            conn = ConnectionManager.getConnection();
            pstmt = conn.prepareStatement("SELECT COUNT(*) AS count FROM transactions WHERE id = 1");
            rs = pstmt.executeQuery();
            
            int rowCount = 0;
            if (rs.next()) {
                rowCount = rs.getInt("count");
            }
            
            if (rowCount == 0) {
                pstmt = conn.prepareStatement("INSERT INTO transactions (id, amount) VALUES (1, ?)");
                pstmt.setDouble(1, amount);
                pstmt.executeUpdate();
            } else {
                pstmt = conn.prepareStatement("UPDATE transactions SET amount = amount + ? WHERE id = 1");
                pstmt.setDouble(1, amount);
                pstmt.executeUpdate();
            }
            
        } catch (SQLException e) {
            e.printStackTrace();
        } finally {
            ConnectionManager.close(rs);
            ConnectionManager.close(pstmt);
            ConnectionManager.close(conn);
        }
    }
}
